#!/bin/sh
set -e

apt-get update
apt-get upgrade -y
cd /opt/ruby-build
git pull
./install.sh

RUBY_220=2.2.0 # latest
RUBY_193=1.9.3-p551 # old stable
RUBY_187=1.8.7-p375 # depreciated

RUBY220_PATH=/opt/rubies/$RUBY_220
RUBY193_PATH=/opt/rubies/$RUBY_193
RUBY187_PATH=/opt/rubies/$RUBY_187

export RUBY_CONFIGURE_OPTS="--disable-install-doc"
echo "gem: --no-ri --no-rdoc" > /.gemrc

export MAKE_OPTS="-j2"

mkdir -p /opt/rubies/latest

echo "Installing $RUBY_220"
/usr/local/bin/ruby-build $RUBY_220 $RUBY220_PATH
PATH=$RUBY220_PATH/bin gem install bundler

echo "Installing $RUBY_193"
/usr/local/bin/ruby-build $RUBY_193 $RUBY193_PATH
PATH=$RUBY193_PATH/bin gem install bundler rake

echo "Installing $RUBY_187"
/usr/local/bin/ruby-build $RUBY_187 $RUBY187_PATH
PATH=$RUBY187_PATH/bin gem install bundler rake

ln -s $RUBY220_PATH/bin/ruby /opt/rubies/latest/ruby
